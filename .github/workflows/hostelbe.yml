# name: üöÄ Deploy to Cloud Run (Hostelbe Testing)

# on:
#   push:
#     branches:
#       - dev    # üëà Change branch to 'dev' if you want separate test branch
#                # or keep 'main' if you want same branch

# env:
#   PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
#   REGION: ${{ secrets.REGION }}
#   SERVICE_NAME: hostelbe                # üëà New Cloud Run service name
#   REPO_NAME: hostelbe                   # üëà You can keep same repo or new one

# jobs:
#   deploy:
#     runs-on: ubuntu-latest

#     steps:
#       - name: üßæ Checkout code
#         uses: actions/checkout@v4

#       - name: üîß Set up Google Cloud SDK
#         uses: google-github-actions/setup-gcloud@v2
#         with:
#           project_id: ${{ env.PROJECT_ID }}
#           service_account_key: ${{ secrets.GCP_SA_KEY }}
#           export_default_credentials: true

#       - name: üîê Authenticate Docker to Artifact Registry
#         run: |
#           echo "Authenticating Docker with Artifact Registry..."
#           echo '${{ secrets.GCP_SA_KEY }}' > key.json
#           gcloud auth activate-service-account --key-file=key.json
#           gcloud auth configure-docker ${{ env.REGION }}-docker.pkg.dev --quiet

#       - name: üîç Verify Authentication & Repository Access
#         run: |
#           gcloud auth list
#           gcloud artifacts repositories list \
#             --project ${{ env.PROJECT_ID }} \
#             --location=${{ env.REGION }}

#       - name: üê≥ Build and Push Docker Image
#         run: |
#           IMAGE="${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/${{ env.REPO_NAME }}/${{ env.SERVICE_NAME }}:${{ github.sha }}"
#           echo "Building image: $IMAGE"
#           docker build -t $IMAGE .
#           docker push $IMAGE

#       - name: üöÄ Deploy to Cloud Run
#         run: |
#           IMAGE="${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/${{ env.REPO_NAME }}/${{ env.SERVICE_NAME }}:${{ github.sha }}"
#           echo "Deploying image: $IMAGE"
#           gcloud run deploy ${{ env.SERVICE_NAME }} \
#             --image $IMAGE \
#             --region ${{ env.REGION }} \
#             --platform managed \
#             --allow-unauthenticated \
#             --port 8080
